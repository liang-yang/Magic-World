<!-- toc -->

# 稀疏矩阵存储（CSR）

---

稀疏矩阵是指矩阵中的元素大部分是0的矩阵。事实上，实际问题中大规模矩阵基本上都是稀疏矩阵，很多稀疏度在90%甚至99%以上。因此我们需要有高效的稀疏矩阵存储格式。这里主要讲两种格式：COO 和 CSR。

## 1. COO: Coordinate

COO 是最简单的一种格式，每一个元素需要用一个三元组来表示，分别是（行号，列号，数值），对应下图右边的一列。

![](https://ws4.sinaimg.cn/large/006tNc79gy1fz1bfr8oy6j30d906y3ym.jpg)

这种方式最简单直观，但是记录单信息多（行列），每个三元组自己可以定位，因此空间不是最优。

## 2. CSR: Compressed Sparse Row

CSR是比较标准的一种，也是 sklearn 包使用的格式，如下图所示：

![](https://ws3.sinaimg.cn/large/006tNc79gy1fz1bljo8psj30db071q31.jpg)

CSR 也需要三类数据来表达：数值，列号，以及行偏移。

> 注意，行偏移量并不是与所有非0元素一一对应的，因此，CSR不是三元组，而是整体的编码方式。

CSR 的数值和列号与 COO 一致，表示一个元素以及其列号，**行偏移表示某一行的第一个非0元素在values数组里面的起始偏移位置**。因此，有多少行，就会有多少行偏移量。

> 如上图中：
1. 第一行的首非0元素1在values数组中是0偏移，因此 行偏移数组第一位是0；
2. 第二行的首非0元素2在values数组中是2偏移，因此 行偏移数组第二位是2；
3. 第三行的首非0元素5在values数组中是4偏移，因此 行偏移数组第三位是4；
4. 第四行的首非0元素6在values数组中是7偏移，因此 行偏移数组第四位是7；

最后，在 行偏移数组 补上矩阵总的非0元素个数。
